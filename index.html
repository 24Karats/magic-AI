<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0"
  />
  <title>MIXXIN AI åœ–ç‰‡ç”Ÿæˆå™¨ï¼ˆCanvas ç‰ˆï¼‰</title>
  <style>
    :root{
      --bg-color:#FFF9E6;
      --card-bg-color:#FFFFFF;
      --border-color:#DCD7C9;
      --text-color:#3C2F2F;
      --text-secondary-color:#7D6E6E;
      --accent-color:#FFC107;
      --accent-gradient:linear-gradient(45deg,#FFD700,#FFA500);
      --success-color:#4CAF50;
      --danger-color:#F44336;
    }
    *{box-sizing:border-box}
    body{
      font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Arial,sans-serif;
      background:var(--bg-color);
      color:var(--text-color);
      margin:0; padding:2rem;
      display:flex; justify-content:center; align-items:flex-start;
      min-height:100vh;
    }
    .container{width:100%; max-width:1200px}
    h1{
      text-align:center; font-size:2.2rem;
      display:flex; align-items:center; justify-content:center; gap:10px;
      margin:0 0 .25rem;
    }
    .header-icon{height:40px; width:auto}
    .subtitle{ text-align:center; color:var(--text-secondary-color); margin:0 0 1rem}
    .main-grid{display:grid; grid-template-columns:1fr 1fr; gap:2rem; margin-top:1.25rem}
    .input-section,.output-section{display:flex; flex-direction:column; gap:1rem}
    .image-uploads{display:grid; grid-template-columns:1fr 1fr; gap:1rem}
    .upload-box,.result-box{
      background:var(--card-bg-color);
      border:2px dashed var(--border-color);
      border-radius:12px; padding:1rem;
      display:flex; justify-content:center; align-items:center;
      position:relative; aspect-ratio:1/1; overflow:hidden;
      transition:border-color .3s;
    }
    .upload-box:hover{border-color:var(--accent-color)}
    .upload-box label{
      cursor:pointer; text-align:center; color:var(--text-secondary-color);
      display:flex; flex-direction:column; justify-content:center; align-items:center;
      width:100%; height:100%;
    }
    .upload-box input[type="file"]{display:none}
    .upload-box canvas,.result-box canvas{width:100%; height:100%; object-fit:contain; border-radius:8px}
    .remove-btn{
      position:absolute; top:10px; right:10px;
      background:rgba(0,0,0,.7); color:#fff; border:none; border-radius:50%;
      width:24px; height:24px; cursor:pointer; display:none; place-items:center;
    }
    .prompt-box,.action-box,.status-box{
      background:var(--card-bg-color);
      border:1px solid var(--border-color);
      border-radius:12px; padding:1rem;
    }
    h3{
      margin:0 0 .75rem; border-bottom:1px solid var(--border-color);
      padding-bottom:.5rem; font-size:1rem; color:var(--text-secondary-color);
      display:flex; justify-content:space-between; align-items:center;
    }
    #prompt-input{
      width:100%; height:90px; background:#fff;
      border:1px solid var(--border-color); border-radius:8px;
      color:var(--text-color); padding:.75rem; font-size:1rem; resize:vertical;
    }
    .example-buttons{display:flex; flex-wrap:wrap; gap:.5rem; margin-top:.6rem}
    .prompt-chip{
      display:inline-flex; align-items:center; gap:.5rem;
      background:none; border:1px solid var(--border-color);
      color:var(--text-secondary-color); padding:.45rem .9rem;
      border-radius:20px; cursor:pointer; transition:.2s;
    }
    .prompt-chip:hover{background:var(--border-color); color:var(--text-color)}
    .prompt-chip .prompt-text{flex-grow:1}
    .prompt-chip .edit-input{
      border:none; background:transparent; border-bottom:1px solid var(--accent-color);
      color:var(--text-color); outline:none; padding:2px; font-size:inherit; min-width:10ch;
    }
    .chip-icon{
      background:none; border:none; cursor:pointer; padding:2px;
      display:flex; align-items:center; justify-content:center; border-radius:50%;
    }
    .chip-icon:hover{background:rgba(0,0,0,.08)}
    #add-prompt-btn{font-size:1.2rem; font-weight:700; line-height:1}
    #generate-btn,#download-btn{
      width:100%; padding:1rem; font-size:1.05rem; font-weight:700;
      border:none; border-radius:8px; cursor:pointer; transition:opacity .25s;
    }
    #copy-to-input1-btn{
      background:#A0C49D; color:#333; width:100%; padding:.8rem;
      font-size:1rem; font-weight:700; border:none; border-radius:8px;
      cursor:pointer; transition:opacity .25s; display:none;
    }
    #generate-btn{background:var(--accent-gradient); color:#333}
    #download-btn{
      margin-top:.6rem; background:#FFA000; color:#333; text-decoration:none; display:block; text-align:center;
      pointer-events:none; opacity:.6;
    }
    #download-btn.enabled{pointer-events:auto; opacity:1}
    #generate-btn:disabled,#copy-to-input1-btn:disabled{opacity:.5; cursor:not-allowed}
    .result-box{border-style:solid}
    #result-placeholder,#loader{color:var(--text-secondary-color); text-align:center}
    #loader{display:none}
    #ai-response{font-size:.92rem; color:var(--text-secondary-color); margin-top:.5rem; white-space:pre-wrap}
    @media (max-width:900px){.main-grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="container">
    <h1>
      <img class="header-icon" src="https://i.postimg.cc/BQ0nRvL7/generated-image-1-removebg-preview.png" alt="MIXXIN AI Icon" />
      MIXXIN AI
    </h1>
    <p class="subtitle">ä¸Šå‚³ä¸€æˆ–å…©å¼µåœ–ç‰‡ï¼Œæè¿°æ‚¨æƒ³å¦‚ä½•æ”¹è®Šæˆ–çµåˆå®ƒå€‘ã€‚AI æœƒå¯¦ç¾æ‚¨çš„å‰µæ„ã€‚</p>

    <div class="main-grid">
      <!-- å·¦ï¼šè¼¸å…¥ -->
      <div class="input-section">
        <div class="image-uploads">
          <div class="upload-box">
            <label for="file-input-1" id="upload-label-1"><span>1. ä¸Šå‚³ç¬¬ä¸€å¼µåœ–ç‰‡</span></label>
            <canvas id="canvas-1" style="display:none;"></canvas>
            <input type="file" id="file-input-1" accept="image/*" />
            <button class="remove-btn" id="remove-btn-1">Ã—</button>
          </div>
          <div class="upload-box">
            <label for="file-input-2" id="upload-label-2"><span>2. ä¸Šå‚³ç¬¬äºŒå¼µåœ–ç‰‡ï¼ˆå¯é¸ï¼‰</span></label>
            <canvas id="canvas-2" style="display:none;"></canvas>
            <input type="file" id="file-input-2" accept="image/*" />
            <button class="remove-btn" id="remove-btn-2">Ã—</button>
          </div>
        </div>

        <div class="prompt-box">
          <h3>
            <span>3. è¼¸å…¥ç·¨è¼¯æŒ‡ä»¤</span>
            <button id="add-prompt-btn" class="chip-icon">+</button>
          </h3>
          <textarea id="prompt-input" placeholder="é»æ“Šä¸‹æ–¹ç¯„æœ¬æˆ–è‡ªè¡Œè¼¸å…¥æŒ‡ä»¤..."></textarea>
          <div class="example-buttons" id="example-buttons-container"></div>
        </div>

        <button id="generate-btn">âš¡ï¸ ç”¢ç”Ÿåœ–ç‰‡</button>
      </div>

      <!-- å³ï¼šè¼¸å‡º -->
      <div class="output-section">
        <div class="result-box">
          <div id="result-placeholder">ç·¨è¼¯å¾Œåœ–ç‰‡</div>
          <div id="loader">ğŸ¨ AI æ­£åœ¨æ®ç‘å‰µæ„... è«‹ç¨å€™...</div>
          <canvas id="result-canvas" style="display:none;"></canvas>
        </div>
        <button id="copy-to-input1-btn">â†©ï¸ è¤‡è£½åˆ°ç¬¬ä¸€å¼µåœ–</button>
        <a id="download-btn" class="" href="#" download="generated_image.png">â¬‡ï¸ ä¸‹è¼‰åœ–ç‰‡</a>
        <div class="status-box">
          <h3>AI å›æ‡‰ï¼š</h3>
          <p id="ai-response">æ¨¡å‹å°šåœ¨ç­‰å¾…ä»»ä½•æŒ‡ä»¤ã€‚</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    // â˜…â˜…â˜… æŠŠé€™å€‹æ”¹æˆä½ çš„ n8n Webhook â˜…â˜…â˜…
    const N8N_WEBHOOK_URL = 'https://n8n.mixxin.tw/webhook/55dc8853-afd8-41ed-a271-2a8ed64737cd';

    // DOM
    const fileInput1 = document.getElementById('file-input-1');
    const fileInput2 = document.getElementById('file-input-2');
    const canvas1 = document.getElementById('canvas-1');
    const canvas2 = document.getElementById('canvas-2');
    const uploadLabel1 = document.getElementById('upload-label-1');
    const uploadLabel2 = document.getElementById('upload-label-2');
    const removeBtn1 = document.getElementById('remove-btn-1');
    const removeBtn2 = document.getElementById('remove-btn-2');
    const promptInput = document.getElementById('prompt-input');
    const generateBtn = document.getElementById('generate-btn');
    const downloadBtn = document.getElementById('download-btn');
    const resultPlaceholder = document.getElementById('result-placeholder');
    const loader = document.getElementById('loader');
    const resultCanvas = document.getElementById('result-canvas');
    const aiResponse = document.getElementById('ai-response');
    const exampleButtonsContainer = document.getElementById('example-buttons-container');
    const addPromptBtn = document.getElementById('add-prompt-btn');
    const copyToInput1Btn = document.getElementById('copy-to-input1-btn');

    // ç‹€æ…‹
    let imageInfo1 = null;
    let imageInfo2 = null;
    let currentResultImage = null;     // <Image>
    let currentResultMime = null;      // 'image/png'...
    let currentObjectUrl = null;       // for binary blob revoke

    // -------- å·¥å…· --------

    // é«˜ç•«è³ªè¼¸å…¥ï¼šç­‰æ¯”ç¸®åˆ°ä¸Šé™ + é«˜å“è³ª JPEGï¼ˆè‹¥è¼¸å…¥ç‚º JPEGï¼‰
    function getImageDataForApi(image, mimeType, maxSize = 1536) {
      const offscreenCanvas = document.createElement('canvas');
      const ctx = offscreenCanvas.getContext('2d');
      let { width, height } = image;

      if (width > height) {
        if (width > maxSize) {
          height = Math.round(height * (maxSize / width));
          width = maxSize;
        }
      } else {
        if (height > maxSize) {
          width = Math.round(width * (maxSize / height));
          height = maxSize;
        }
      }
      offscreenCanvas.width = width;
      offscreenCanvas.height = height;
      ctx.imageSmoothingQuality = 'high';
      ctx.drawImage(image, 0, 0, width, height);

      const quality = mimeType === 'image/jpeg' ? 0.95 : undefined;
      return offscreenCanvas.toDataURL(mimeType, quality).split(',')[1]; // ç´” base64
    }

    // é«˜ DPI ç•«å¸ƒç¹ªè£½
    function drawImageOnCanvas(image, canvas) {
      const ctx = canvas.getContext('2d');
      const container = canvas.parentElement;

      const cssW = container.clientWidth || 512;
      const cssH = container.clientHeight || 512;

      const dpr = Math.max(1, window.devicePixelRatio || 1);
      canvas.width = Math.max(1, Math.round(cssW * dpr));
      canvas.height = Math.max(1, Math.round(cssH * dpr));
      canvas.style.width = cssW + 'px';
      canvas.style.height = cssH + 'px';

      const canvasRatio = canvas.width / canvas.height;
      const imageRatio = image.width / image.height;

      let drawW, drawH, offsetX, offsetY;
      if (imageRatio > canvasRatio) {
        drawW = canvas.width;
        drawH = drawW / imageRatio;
        offsetX = 0;
        offsetY = (canvas.height - drawH) / 2;
      } else {
        drawH = canvas.height;
        drawW = drawH * imageRatio;
        offsetY = 0;
        offsetX = (canvas.width - drawW) / 2;
      }

      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.imageSmoothingQuality = 'high';
      ctx.drawImage(image, offsetX, offsetY, drawW, drawH);
      canvas.style.display = 'block';
    }

    function clearCanvas(canvas, label, removeBtn) {
      const ctx = canvas.getContext('2d');
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      canvas.style.display = 'none';
      label.style.display = 'flex';
      removeBtn.style.display = 'none';
    }

    // ä¸Šå‚³è¨­å®š
    function setupImageUpload(fileInput, canvas, label, removeBtn, assignInfo) {
      fileInput.addEventListener('change', (e) => {
        const file = e.target.files?.[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (ev) => {
          const img = new Image();
          img.onload = () => {
            assignInfo({ mimeType: file.type, imageObject: img });
            drawImageOnCanvas(img, canvas);
            label.style.display = 'none';
            removeBtn.style.display = 'grid';
          };
          img.src = ev.target.result;
        };
        reader.readAsDataURL(file);
      });

      removeBtn.addEventListener('click', () => {
        fileInput.value = '';
        clearCanvas(canvas, label, removeBtn);
        assignInfo(null);
      });
    }

    function setLoadingState(isLoading) {
      if (isLoading) {
        generateBtn.disabled = true;
        generateBtn.textContent = 'ç”Ÿæˆä¸­...';
        resultPlaceholder.style.display = 'none';
        resultCanvas.style.display = 'none';
        loader.style.display = 'block';
        aiResponse.textContent = 'å·²å°‡è«‹æ±‚ç™¼é€åˆ° AIï¼Œè«‹ç¨å€™...';
        copyToInput1Btn.style.display = 'none';
        downloadBtn.classList.remove('enabled');
        if (currentObjectUrl) {
          URL.revokeObjectURL(currentObjectUrl);
          currentObjectUrl = null;
        }
      } else {
        generateBtn.disabled = false;
        generateBtn.textContent = 'âš¡ï¸ ç”¢ç”Ÿåœ–ç‰‡';
        loader.style.display = 'none';
        if (currentResultImage) {
          copyToInput1Btn.style.display = 'block';
        }
      }
    }

    // -------- ä¸»è¦æµç¨‹ --------

    async function handleGenerateClick() {
      if (!imageInfo1 || !promptInput.value.trim()) {
        aiResponse.textContent = 'éŒ¯èª¤ï¼šè«‹è‡³å°‘ä¸Šå‚³ç¬¬ä¸€å¼µåœ–ç‰‡ä¸¦è¼¸å…¥ç·¨è¼¯æŒ‡ä»¤ã€‚';
        return;
      }

      setLoadingState(true);
      currentResultImage = null;
      currentResultMime = null;

      try {
        const payload = {
          prompt: promptInput.value,
          image1_mimeType: imageInfo1 ? imageInfo1.mimeType : null,
          image1_data: imageInfo1 ? getImageDataForApi(imageInfo1.imageObject, imageInfo1.mimeType) : null,
          image2_mimeType: imageInfo2 ? imageInfo2.mimeType : null,
          image2_data: imageInfo2 ? getImageDataForApi(imageInfo2.imageObject, imageInfo2.mimeType) : null
        };

        const response = await fetch(N8N_WEBHOOK_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'Accept': '*/*' },
          body: JSON.stringify(payload)
        });

        const ct = (response.headers.get('content-type') || '').toLowerCase();

        // A) Binary ç›´å‚³
        if (ct.startsWith('image/')) {
          const blob = await response.blob();
          currentResultMime = ct.split(';')[0];
          const objectUrl = URL.createObjectURL(blob);
          currentObjectUrl = objectUrl;

          downloadBtn.href = objectUrl;
          downloadBtn.classList.add('enabled');

          const img = new Image();
          img.onload = () => {
            drawImageOnCanvas(img, resultCanvas);
            resultCanvas.style.display = 'block';
            currentResultImage = img;
            copyToInput1Btn.style.display = 'block';
          };
          img.src = objectUrl;

          aiResponse.textContent = 'åœ–ç‰‡å·²æˆåŠŸç”Ÿæˆï¼ï¼ˆBinary ç›´å‚³ï¼‰';
          return;
        }

        // B) JSON å…§åµŒ
        const rawText = await response.text();
        if (!response.ok) {
          // æœ€å¤§åŒ–éŒ¯èª¤å¯è®€æ€§
          let msg = rawText;
          try {
            const errJson = JSON.parse(rawText);
            msg = errJson.message || errJson.error || rawText;
          } catch (_) {}
          throw new Error(`ä¼ºæœå™¨éŒ¯èª¤ï¼š${msg}`);
        }

        let result;
        try {
          result = JSON.parse(rawText);
        } catch (_) {
          throw new Error(`å›å‚³å…§å®¹éåœ–ç‰‡äº¦éåˆæ³• JSONï¼š${rawText.slice(0, 200)}...`);
        }

        const candidates = Array.isArray(result.candidates) ? result.candidates : [];
        const parts = candidates[0]?.content?.parts || [];

        const findImagePart = () => {
          for (const p of parts) {
            const inl = p.inlineData || p.inline_data;
            if (inl && typeof inl.data === 'string') {
              const mt = inl.mimeType || inl.mime_type || '';
              if (mt.startsWith('image/')) return { data: inl.data, mime: mt };
            }
          }
          return null;
        };

        const imgPart = findImagePart();
        if (imgPart) {
          currentResultMime = imgPart.mime;
          const dataUrl = `data:${imgPart.mime};base64,${imgPart.data}`;

          downloadBtn.href = dataUrl;
          downloadBtn.classList.add('enabled');

          const img = new Image();
          img.onload = () => {
            drawImageOnCanvas(img, resultCanvas);
            resultCanvas.style.display = 'block';
            currentResultImage = img;
            copyToInput1Btn.style.display = 'block';
          };
          img.src = dataUrl;

          aiResponse.textContent = 'åœ–ç‰‡å·²æˆåŠŸç”Ÿæˆï¼ï¼ˆJSON å…§åµŒ base64ï¼‰';
          return;
        }

        const textResp = parts.find(p => typeof p.text === 'string')?.text;
        throw new Error(textResp ? `AI å›å‚³äº†æ–‡å­—ï¼š${textResp.slice(0, 200)}...` : 'AI å›å‚³å…§å®¹ä¸­æœªæ‰¾åˆ°åœ–ç‰‡ã€‚');

      } catch (err) {
        console.error(err);
        aiResponse.textContent = `ç™¼ç”ŸéŒ¯èª¤ï¼š${err.message}`;
        const ctx = resultCanvas.getContext('2d');
        ctx.clearRect(0, 0, resultCanvas.width, resultCanvas.height);
        resultCanvas.style.display = 'none';
        resultPlaceholder.style.display = 'block';
        currentResultImage = null;
        downloadBtn.classList.remove('enabled');
        if (currentObjectUrl) {
          URL.revokeObjectURL(currentObjectUrl);
          currentObjectUrl = null;
        }
      } finally {
        setLoadingState(false);
      }
    }

    // æŠŠç”Ÿæˆåœ–ä¸Ÿå›ç¬¬ä¸€å¼µ
    function handleCopyToInput1() {
      if (!currentResultImage || !currentResultMime) {
        aiResponse.textContent = 'æ²’æœ‰ç”Ÿæˆå¥½çš„åœ–ç‰‡å¯ä»¥è¤‡è£½ã€‚';
        return;
      }

      // æ¸…ç¬¬ä¸€å¼µ
      fileInput1.value = '';
      clearCanvas(canvas1, uploadLabel1, removeBtn1);
      imageInfo1 = null;

      // é¡¯ç¤º
      drawImageOnCanvas(currentResultImage, canvas1);
      uploadLabel1.style.display = 'none';
      removeBtn1.style.display = 'grid';

      // æ›´æ–° imageInfo1 ä»¥åˆ©å†æ¬¡é€å‡º
      imageInfo1 = { mimeType: currentResultMime, imageObject: currentResultImage };

      aiResponse.textContent = 'ç”Ÿæˆåœ–ç‰‡å·²è¤‡è£½åˆ°ç¬¬ä¸€å¼µåœ–ä½ç½®ï¼æ‚¨å¯ä»¥ç¹¼çºŒé€²è¡Œç·¨è¼¯ã€‚';
      copyToInput1Btn.style.display = 'none';

      // é‡‹æ”¾ objectUrlï¼ˆè‹¥ä¾†æºç‚º blobï¼‰ï¼Œä½†ä¸å½±éŸ¿ç•«å¸ƒ
      if (currentObjectUrl) {
        URL.revokeObjectURL(currentObjectUrl);
        currentObjectUrl = null;
      }
      currentResultImage = null;
      currentResultMime = null;
    }

    // -------- ç¯„æœ¬æŒ‡ä»¤ï¼ˆå¯ç·¨è¼¯/æ–°å¢/åˆªé™¤ï¼‰ --------
    const PROMPT_STORAGE_KEY = 'customExamplePrompts_v2';
    const defaultPrompts = [
      'æŠŠç¬¬ä¸€å¼µåœ–è½‰æˆé»‘è‰²ç·šæ¢çš„å¡é€šç·šç¨¿ï¼ŒèƒŒæ™¯ç•™ç™½ã€‚',
      'èåˆå…©å¼µåœ–çš„ä¸»é«”èˆ‡æ§‹åœ–ï¼Œé¢¨æ ¼çµ±ä¸€ç‚ºæ—¥ç³»æ’ç•«ã€‚',
      'æŠŠç¬¬ä¸€å¼µåœ–çš„äººè‡‰è‡ªç„¶åœ°æ›åˆ°ç¬¬äºŒå¼µåœ–çš„ä¸»é«”ä¸Šã€‚',
      'å°‡ç¬¬ä¸€å¼µåœ–çš„é¢¨æ ¼å¥—ç”¨åˆ°ç¬¬äºŒå¼µåœ–ï¼Œé¡è‰²æŸ”å’Œã€‚'
    ];
    const icons = {
      edit:'âœï¸', save:'âœ…', del:'âŒ'
    };
    function getPrompts(){
      try{
        const t = localStorage.getItem(PROMPT_STORAGE_KEY);
        return t ? JSON.parse(t) : defaultPrompts.slice();
      }catch{ return defaultPrompts.slice(); }
    }
    function savePrompts(prompts){
      localStorage.setItem(PROMPT_STORAGE_KEY, JSON.stringify(prompts));
    }
    function renderExampleButtons(){
      const prompts = getPrompts();
      exampleButtonsContainer.innerHTML = '';
      prompts.forEach((text, idx) => {
        const chip = document.createElement('div');
        chip.className = 'prompt-chip';
        chip.dataset.index = idx;
        chip.innerHTML = `
          <span class="prompt-text">${text}</span>
          <button class="chip-icon edit-icon" title="ç·¨è¼¯">${icons.edit}</button>
        `;
        exampleButtonsContainer.appendChild(chip);
      });
    }
    exampleButtonsContainer.addEventListener('click', (e) => {
      const target = e.target.closest('button, .prompt-text'); if (!target) return;
      const chip = target.closest('.prompt-chip');
      const index = parseInt(chip.dataset.index, 10);
      let prompts = getPrompts();

      if (target.classList.contains('edit-icon')) {
        const currentText = chip.querySelector('.prompt-text').textContent;
        chip.innerHTML = `
          <input type="text" class="edit-input" value="${currentText}">
          <button class="chip-icon save-icon" title="å„²å­˜">${icons.save}</button>
          <button class="chip-icon delete-icon" title="åˆªé™¤">${icons.del}</button>
        `;
        chip.querySelector('.edit-input').focus();
      } else if (target.classList.contains('save-icon')) {
        const input = chip.querySelector('.edit-input');
        const newText = (input.value || '').trim();
        if (newText) { prompts[index] = newText; savePrompts(prompts); }
        renderExampleButtons();
      } else if (target.classList.contains('delete-icon')) {
        if (confirm(`ç¢ºå®šè¦åˆªé™¤ç¯„æœ¬ã€Œ${prompts[index]}ã€å—ï¼Ÿ`)) {
          prompts.splice(index, 1); savePrompts(prompts); renderExampleButtons();
        }
      } else if (target.classList.contains('prompt-text')) {
        promptInput.value = target.textContent;
      }
    });
    addPromptBtn.addEventListener('click', () => {
      const newPrompt = prompt('è«‹è¼¸å…¥è¦æ–°å¢çš„ç¯„æœ¬æŒ‡ä»¤ï¼š');
      if (newPrompt && newPrompt.trim()) {
        const prompts = getPrompts();
        prompts.push(newPrompt.trim());
        savePrompts(prompts);
        renderExampleButtons();
      }
    });

    // -------- åˆå§‹åŒ– --------
    function initialize(){
      setupImageUpload(
        fileInput1, canvas1, uploadLabel1, removeBtn1,
        (val) => { imageInfo1 = val; }
      );
      setupImageUpload(
        fileInput2, canvas2, uploadLabel2, removeBtn2,
        (val) => { imageInfo2 = val; }
      );
      generateBtn.addEventListener('click', handleGenerateClick);
      copyToInput1Btn.addEventListener('click', handleCopyToInput1);
      renderExampleButtons();

      // è¦–çª—ç¸®æ”¾æ™‚é‡ç•«ï¼ˆè‹¥å·²è¼‰å…¥åœ–ç‰‡ï¼‰
      window.addEventListener('resize', () => {
        if (imageInfo1?.imageObject) drawImageOnCanvas(imageInfo1.imageObject, canvas1);
        if (imageInfo2?.imageObject) drawImageOnCanvas(imageInfo2.imageObject, canvas2);
        if (currentResultImage) drawImageOnCanvas(currentResultImage, resultCanvas);
      });
    }
    initialize();
  </script>
</body>
</html>
